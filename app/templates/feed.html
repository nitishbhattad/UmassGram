
{% extends "base.html" %}
{% block title %}Your Feed | UmassGram{% endblock %}
{% block content %}
<div style="max-width: 700px; margin: auto; padding: 20px;">
  <h2>üåê The Umassverse</h2>


  {% if posts %}
  {% for post in posts %}
    
  <div style="border: 1px solid rgba(255, 255, 255, 0.3); padding: 15px; margin-bottom: 20px; border-radius: 15px; background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">


     <!-- Username + Follow button in one line -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
  <!-- Clickable Username -->
  <p style="margin: 0;">
    <strong>
      <a href="{{ url_for('main.profile', username=post['username']) }}" style="text-decoration: none; color: #007bff;">
        {{ post['username'] }}
      </a>
    </strong>
  </p>

  <!-- Follow Button -->
  {% if post['user_id'] != current_user.id %}
    <form method="POST" action="{{ url_for('main.follow', user_id=post['user_id']) }}">
      <button type="submit" style="background: #eee; border: none; padding: 5px 10px; border-radius: 6px;">
        {% if post['is_following'] %}
          ‚úÖ Following
        {% else %}
          ‚ûï Follow
        {% endif %}
      </button>
    </form>
  {% endif %}
</div>

      <!-- Post Image -->
      {% if post['image_path'] %}
        <img src="{{ url_for('static', filename='uploads/' ~ post['image_path']) }}" style="max-width: 100%; width: 400px; border-radius: 10px;">
      {% else %}
        <p>[No image uploaded]</p>
      {% endif %}

      <p>{{ post['caption'] }}</p>
      <p style="font-size: small; color: gray;">Posted on {{ post['created_at'] }}</p>

      <!-- Reactions -->
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 5px 10px; margin-top: 10px;">
        <!-- Like -->
        <form method="POST" action="{{ url_for('main.like', post_id=post['post_id']) }}" style="margin: 0;">
          <button type="submit" style="font-size: 20px; background: none; border: none; cursor: pointer;">
            {% if post['user_liked'] %} ‚ù§Ô∏è {% else %} ü§ç {% endif %}
            {{ post['like_count'] }}
          </button>
        </form>

        <!-- Comment -->
        <!-- Comment Icon with toggle -->
        <div onclick="toggleComments('comments-{{ post.post_id }}')" style="font-size: 20px; color: #333; cursor: pointer;">
            üí¨ {{ post.comment_count or 0 }}
          </div>
          
  
        
  

        <!-- Save -->
        <form method="POST" action="{{ url_for('main.save_post', post_id=post['post_id']) }}" style="margin: 0;">
          <button type="submit" style="font-size: 20px; background: none; border: none; cursor: pointer;">
            {% if post['is_saved'] %} ‚≠ê {% else %} ‚≠ê {% endif %}
          </button>
        </form>
      </div>

      <!-- Comment Form -->
      <!-- Hidden comments section -->
<div id="comments-{{ post['post_id'] }}" style="display: none; margin-top: 10px; padding-left: 10px;">
    <p><strong>Comments:</strong></p>
    {% for c in comments %}
      {% if c['post_id'] == post['post_id'] %}
        <p><strong>{{ c['username'] }}</strong>: {{ c['content'] }}</p>
      {% endif %}
    {% endfor %}
  
    <!-- Add Comment Form -->
    <form method="POST" action="{{ url_for('main.comment', post_id=post['post_id']) }}">
      <input type="text" name="comment" placeholder="Add a comment..." required style="width: 70%;">
      <button type="submit">Post</button>
    </form>
  </div>
  {% if post['user_id'] == current_user.id %}
  <form method="POST" action="{{ url_for('main.delete_post', post_id=post['post_id']) }}" style="display: inline;">
    <button type="submit" style="background: none; border: none; color: red; cursor: pointer;" onclick="return confirm('Are you sure you want to delete this post?')">
      üóëÔ∏è Delete
    </button>
  </form>
{% endif %}
{% if post['user_id'] == current_user.id %}
  <div style="margin-top: 10px;">
    <p><strong>üëª secret comment:</strong></p>
    {% for fb in feedbacks %}
      {% if fb['post_id'] == post['post_id'] %}
        <p><strong>{{ fb['username'] }}</strong>: {{ fb['content'] }}</p>
      {% endif %}
    {% endfor %}
  </div>
{% endif %}


<!-- Anonymous Feedback Form -->
<form method="POST" action="{{ url_for('main.feedback', post_id=post['post_id']) }}">
    <input type="text" name="feedback" placeholder="Send secret comment..." required style="width: 70%; margin-top: 10px;">
    <button type="submit">Send</button>
  </form>
  

    </div> <!-- üîö post card ends -->
  {% endfor %}
{% else %}
  <p>No posts to show yet.</p>
{% endif %}

<script>
    function toggleComments(id) {
      const el = document.getElementById(id);
      if (el.style.display === "none") {
        el.style.display = "block";
      } else {
        el.style.display = "none";
      }
    }
  </script>
  
  {% endblock %}